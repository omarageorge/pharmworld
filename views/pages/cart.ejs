<%- include('../partials/layout_top') -%>


      <section id="cart">
        <% if (items.length > 0 ) { %>

          <% let totalPrice = 0  %> 

          <% items.forEach((item) => { %>
            <% totalPrice += item.product.price * item.quantity %>
          <% }) %>
          
          <div id="checkout">
            <h1>
              Your total is
              <span style="color: #008000"> $<%= totalPrice %>  </span>
            </h1>
          </div>

          <table>
            <caption>
              Items in cart
            </caption>
          
            <thead>
              <tr>
                <th>Product</th>
                <th>Price</th>
                <th>Quantity</th>
                <th>Total</th>
                <th>Actions</th>
              </tr>
            </thead>
          
            <tbody>
              <% items.forEach( item  => { %>
          
                <% const total = item.product.price * item.quantity %>
          
                <tr>
                  <td><%= item.product.name %></td>
                  <td>$<%= item.product.price %></td>
                  <td>
                    <form method="POST" action="/cart?_method=PUT">
                      <input type="number" name="quantity" value=<%= item.quantity %> min=<%= item.product.minimumOrder %> max=<%= item.product.countInStock %> />

                      <input type="hidden" name="product" value="<%= item.product._id %>" >

                      <button id="save" type="submit">Save change</button>
                    </form>
                    </td>
                  <td>$<%= total %> </td>
                  <td>
                    <form method="POST" action="/cart?_method=DELETE">
                      <input type="hidden" name="product" value="<%= item.product._id %>" >
                      <input type="hidden" name="url" value="/cart" >
                      <button id="remove" type="submit">Remove from cart</button>
                    </form>
                  </td>
                </tr>
              <% }) %> 
            </tbody>
          </table>


          <section id="place-order">
            <form method="POST" action="/orders">
              <div id="form-data">
                <input type="hidden" name="totalPrice" value="<%= totalPrice %>">

                <div class="form-group">
                  <input type="text" name="name" placeholder="Name" required />
                </div>
  
                <div class="form-group">
                  <input
                    type="text"
                    name="street"
                    placeholder="Street + Number"
                    required
                  />
                </div>
  
                <div class="form-group">
                  <input type="text" name="zipcode" placeholder="Zip Code" required />
                </div>
  
                <div class="form-group">
                  <input type="text" name="city" placeholder="City" required />
                </div>
  
                <div class="form-group">
                  <input type="text" name="state" placeholder="State/Region" required />
                </div>
  
                <div class="form-group">
                  <input
                    type="text"
                    name="additional"
                    placeholder="Additional information (optional)"
                  />
                </div>
              </div>
  
              <div id="form-action">
                <button type="submit">Place Order</button>
  
                <a href="/">Continue shopping</a>
              </div>
            </form>
          </section>

         
        <% } else { %>
          <span>No items added to cart</span>
        <% } %> 

        <!-- Cart Items -->
      
      </section>
      
<%- include('../partials/layout_bottom') -%>
